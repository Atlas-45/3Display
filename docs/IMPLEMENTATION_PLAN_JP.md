# 実装計画（ドキュメントに基づく）

## 目的
- PoCロードマップ（`docs/ROADMAP.md`）の項目1〜6を順に具現化し、"画面から飛び出す"錯視を最短で体験可能にする。

## 直近の優先タスク
1. **透明オーバーレイWindow + SceneKit表示**
   - `ThreeDisplayPackage/Sources/ThreeDisplayFeature/ContentView.swift` と `SceneKitOverlayView.swift` にあるオーバーレイ実装を固定化。
   - macOSの全スペースに跨るフローティングWindowとして動作し、背景透過/非シャドウを維持する。
2. **USDZ読み込み + 基本アニメーション**
   - SceneKitシーンにUSDZ読み込みパイプラインを追加し、サンプルモデルをバンドルして常時再生されるアイドルアニメーションを付与する。
   - シンプルなAPIでモデル切替を行えるようにし、PoCデモで即座に利用可能にする。

## 中期タスク
3. **スクリーン面クリップ（ポータル演出）**
   - 画面平面に一致するクリッピング（深度/シェーダ）を導入し、画面奥のジオメトリをマスクして「画面から出てくる」演出を強調。
   - UIからオン/オフ切替できるトグルをSwiftUIレイヤーで提供。
4. **方向/強さスライダと視点オフセット**
   - SwiftUIコントロールでポップアウト方向・強度を調整。
   - Visionベースの顔トラッキングで頭部位置を推定し、SceneKitカメラのオフセット/オフアクシス投影を動的に更新。
5. **ポスト処理と演出強化**
   - Rim light、Bloom/DOFをSCNTechniqueやシェーダモディファイアで適用。
   - スクリーン平面の接地影、パララックス背景、必要に応じて音響キューを追加。プリセット（アバター/プロダクト/ホログラム/ポータル）を用意しUIから選択可能にする。

## テストと検証
- **ビルド/単体テスト**: `xcodebuild -workspace ThreeDisplay.xcworkspace -scheme ThreeDisplay build`、`swift test` を定期実行。
- **体験確認**: 内蔵/外部ディスプレイ双方で表示挙動を確認し、透過・フローティングの継続を保証。
- **プライバシー/権限**: カメラ利用時の Info.plist 用途説明と entitlements を整備する。

## 成果物・マイルストーン
- まずは項目1+2を動作させたPoCデモ（透明オーバーレイでUSDZモデルが回転/バウンスする）をリリース。
- その後、クリッピング・視点オフセット・ポスト処理を段階的に統合し、没入感と安定性を高める。
